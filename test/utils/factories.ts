import { randomUUIDv7 } from "bun"

export const createUserData = (overrides = {}) => {
	return {
		name: "Test User",
		email: `test-${randomUUIDv7()}@example.com`,
		password: "password123",
		password_confirmation: "password123",
		...overrides,
	}
}

export const createImageFile = (
	filename = "avatar.png",
	options?: {
		type?: "png" | "jpg" | "jpeg" | "gif"
	},
) => {
	const type = options?.type || "png"

	// Create a simple 1x1 PNG image
	const pngBuffer = Buffer.from([
		0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a, 0x00, 0x00, 0x00, 0x0d,
		0x49, 0x48, 0x44, 0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
		0x08, 0x06, 0x00, 0x00, 0x00, 0x1f, 0x15, 0xc4, 0x89, 0x00, 0x00, 0x00,
		0x0a, 0x49, 0x44, 0x41, 0x54, 0x78, 0x9c, 0x63, 0x00, 0x01, 0x00, 0x00,
		0x05, 0x00, 0x01, 0x0d, 0x0a, 0x2d, 0xb4, 0x00, 0x00, 0x00, 0x00, 0x49,
		0x45, 0x4e, 0x44, 0xae, 0x42, 0x60, 0x82,
	])

	// Simple 1x1 JPEG image
	const jpegBuffer = Buffer.from([
		0xff, 0xd8, 0xff, 0xe0, 0x00, 0x10, 0x4a, 0x46, 0x49, 0x46, 0x00, 0x01,
		0x01, 0x01, 0x00, 0x48, 0x00, 0x48, 0x00, 0x00, 0xff, 0xdb, 0x00, 0x43,
		0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
		0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc0, 0x00, 0x0b, 0x08, 0x00, 0x01,
		0x00, 0x01, 0x01, 0x01, 0x11, 0x00, 0xff, 0xc4, 0x00, 0x14, 0x00, 0x01,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0xff, 0xc4, 0x00, 0x14, 0x10, 0x01, 0x00, 0x00,
		0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
		0x00, 0x00, 0xff, 0xda, 0x00, 0x08, 0x01, 0x01, 0x00, 0x00, 0x3f, 0x00,
		0x7f, 0xff, 0xd9,
	])

	// Simple 1x1 GIF image
	const gifBuffer = Buffer.from([
		0x47, 0x49, 0x46, 0x38, 0x39, 0x61, 0x01, 0x00, 0x01, 0x00, 0x00, 0x00,
		0x00, 0x21, 0xf9, 0x04, 0x01, 0x00, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x00,
		0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x00, 0x02, 0x01, 0x44, 0x00, 0x3b,
	])

	const mimeTypes = {
		png: "image/png",
		jpg: "image/jpeg",
		jpeg: "image/jpeg",
		gif: "image/gif",
	}

	const buffers = {
		png: pngBuffer,
		jpg: jpegBuffer,
		jpeg: jpegBuffer,
		gif: gifBuffer,
	}

	const mimeType = mimeTypes[type]
	const buffer = buffers[type]

	const blob = new Blob([buffer], { type: mimeType })
	const file = new File([blob], filename, { type: mimeType })

	return file
}

/**
 * Create an invalid file for testing validation
 */
export const createInvalidFile = (
	filename = "test.txt",
	content = "test content",
) => {
	return new File([content], filename, { type: "text/plain" })
}

export const createFormData = (data: Record<string, unknown>) => {
	const formData = new FormData()

	for (const [key, value] of Object.entries(data)) {
		// Skip undefined and null values
		if (value === undefined || value === null) {
			continue
		}

		if (value instanceof File || value instanceof Blob) {
			formData.append(key, value)
		} else if (typeof value === "string" || typeof value === "number") {
			formData.append(key, value.toString())
		} else {
			formData.append(key, JSON.stringify(value))
		}
	}

	return formData
}
